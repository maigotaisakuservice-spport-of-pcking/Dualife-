# Dualife用 Firestore複合インデックス設定ガイド
# ==========================================

このガイドは、「推し活マイルーム」機能が正常に動作するために必要な、Firestoreの複合インデックスを作成する手順を説明します。

## 背景
「マイルーム」では、「特定のユーザーID (`localUserId`) が投稿し、かつ画像(`imageUrl`)が存在する投稿を、新しい順(`createdAt`)に並べ替える」という複雑な検索処理を行っています。
Firestoreでこのような複雑な検索を高速かつ効率的に行うには、「複合インデックス」と呼ばれる、検索条件をあらかじめ定義した索引をデータベースに作成しておく必要があります。

## 設定手順
インデックスを作成するには、2つの方法があります。

### 方法1: エラーメッセージのリンクから直接作成（推奨）
コンソールに表示されたエラーメッセージには、インデックスを自動で作成するための便利なリンクが含まれています。

1.  以下のURLをコピーして、Webブラウザで開きます。
    ```
    https://console.firebase.google.com/v1/r/project/dualife-pdg-group/firestore/indexes?create_composite=ClJwcm9qZWN0cy9kdWFsaWZlLXBkZy1ncm91cC9kYXRhYmFzZXMvKGRlZmF1bHQpL2NvbGxlY3Rpb25Hcm91cHMvdGhvdWdodHMvaW5kZXhlcy9fEAEaDwoLbG9jYWxVc2VySWQQARoMCghpbWFnZVVybBABGg0KCWNyZWF0ZWRBdBACGgwKCF9fbmFtZV9fEAI
    ```
2.  ページが開くと、インデックスの作成画面が表示され、必要な設定がすべて自動で入力された状態になっています。
3.  内容を確認し、「**インデックスを作成**」ボタンをクリックします。

### 方法2: 手動で作成
もし上記リンクが機能しない場合は、手動で設定することも可能です。

1.  **Firebaseコンソール**にアクセスし、『Dualife』プロジェクトを選択します。
2.  左側のメニューから「**Firestore Database**」を選択し、「**インデックス**」タブをクリックします。
3.  「**複合インデックス**」セクションで、「**インデックスを追加**」をクリックします。
4.  以下の通りに設定を入力します。
    *   **コレクションID**: `thoughts`
    *   **インデックスするフィールド**:
        1.  フィールドパス: `localUserId`, 並べ替え順: `昇順`
        2.  フィールドパス: `imageUrl`, 並べ替え順: `昇順`
        3.  フィールドパス: `createdAt`, 並べ替え順: `降順`
    *   **クエリスコープ**: `コレクション`
5.  「**インデックスを作成**」ボタンをクリックします。

## 注意事項
*   インデックスの作成には数分かかる場合があります。ステータスが「有効」になるまでお待ちください。
*   インデックスが有効になると、「マイルーム」機能のエラーは解消され、画像が正しく表示されるようになります。
