# Dualife トラブルシューティングガイド

このガイドは、Dualifeアプリケーションのセットアップや実行中に発生する可能性のある一般的な問題を解決するためのものです。

## 1. Cloudinary画像アップロードの失敗

### 症状
画像のアップロードを試みると、「投稿に失敗しました」というアラートが表示され、ブラウザのコンソールに `420 (Enhance Your Calm)` や `You don't have an active subscription for...` というエラーが表示される。

### 原因
このエラーは、Cloudinaryの**アップロードプリセット**の設定が、現在のアカウントのプランで利用できない機能（特にAI系の有料アドオン）を使用しようとしている場合に発生します。

### 解決策
アップロードプリセットから不要なアドオンを削除する必要があります。

1.  **Cloudinaryにログイン**:
    *   [Cloudinaryのダッシュボード](https://cloudinary.com/console)にアクセスし、ログインします。

2.  **設定画面へ移動**:
    *   画面右上の歯車アイコン（⚙️）をクリックして「Settings」を開きます。

3.  **アップロードプリセットの編集**:
    *   「Upload」タブを選択します。
    *   ページ下部にある「Upload presets」のセクションまでスクロールします。
    *   `dualife-post-image-upload` という名前のプリセットを見つけ、右側の「Edit」をクリックします。

4.  **AIモデレーション機能の無効化**:
    *   プリセットの編集画面で、「Content Analysis」または「Add-ons」といったセクションを探します。
    *   **"Rekognition AI Moderation"** や、その他のAI関連のモデレーション（自動タグ付け、カテゴリ分類など）が有効になっている場合は、それを**無効**または**削除**してください。
    *   ![image](https://res.cloudinary.com/demo/image/upload/v1633535942/docs/upload_preset_moderation.png)
        *(これは設定画面の参考画像です。実際のUIとは異なる場合があります)*

5.  **設定を保存**:
    *   画面下部にある「Save」ボタンをクリックして、変更を保存します。

この設定変更後、アプリケーションに戻って再度画像のアップロードを試みてください。

## 2. Firestoreのクエリ（複合インデックス）エラー

### 症状
「推し活マイルーム」の画像が表示されず、ブラウザのコンソールに `Firestore... The query requires an index.` というエラーが表示される。

### 原因
Firestoreは、複数の異なるフィールドで絞り込み (`where`) と並べ替え (`orderBy`) を同時に行うクエリを実行するために、あらかじめ**複合インデックス**を作成しておく必要があります。

### 解決策
コンソールに表示されたエラーメッセージ内のリンクをクリックするのが最も簡単な方法です。

1.  **エラーメッセージのリンクをクリック**:
    *   ブラウザの開発者ツールを開き、コンソールに表示されているFirestoreのエラーメッセージを探します。
    *   メッセージ内にURLリンクが含まれているはずです。このリンクをクリックすると、Firebaseコンソールが開き、必要なインデックスを作成するための設定がすでに入力された状態のポップアップが表示されます。

2.  **インデックスを作成**:
    *   ポップアップに表示された内容を確認し、「作成」または「Save」ボタンをクリックします。
    *   インデックスの作成には数分かかることがあります。

もしエラーメッセージにリンクがない場合は、以下の手順で手動で作成してください。

1.  **Firebaseコンソールに移動**:
    *   [Firebaseコンソール](https://console.firebase.google.com/)にアクセスし、`dualife-pdg-group` プロジェクトを選択します。

2.  **Firestoreデータベースへ**:
    *   左側のメニューから「ビルド」>「Firestore Database」を選択します。

3.  **インデックス作成**:
    *   「インデックス」タブを選択します。
    *   「複合インデックス」のセクションで、「インデックスを追加」をクリックします。
    *   以下の設定でインデックスを作成します。
        *   **コレクションID**: `thoughts`
        *   **フィールド**:
            1.  `localUserId` (昇順)
            2.  `imageUrl` (昇順)
            3.  `createdAt` (降順)
    *   「作成」をクリックします。

インデックスのステータスが「有効」になったら、マイルームの機能が正しく動作するようになります。
